/**
 * light-storage v0.1.0
 * (c) 2019 xunmi
 * Released under the MIT License.
 */
function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t){var i=t.get(e);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(e):i.value}function i(e,t,i){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,i);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=i}return i}var r,a,n,o=function(){function r(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light-storage";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),l.set(this,{writable:!0,value:void 0}),u.set(this,{writable:!0,value:void 0}),s.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:function(){i(e,u,new Set),Object.keys(t(e,l)).forEach(function(i){i.slice(0,t(e,s).length)===t(e,s)&&t(e,u).add(i)})}});var n=window||self||globalThis;if("[object Storage]"!==Object.prototype.toString.call(n.localStorage))throw new TypeError("当前运行环境不支持 localStorage");i(this,l,n.localStorage),this.prefix=a}var a,n,o;return a=r,(n=[{key:"getFullKey",value:function(e){return e.slice(0,t(this,s).length)===t(this,s)?e:"".concat(t(this,s),"-").concat(e)}},{key:"set",value:function(e,i,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=this.getFullKey(e);var n={value:i};if(r&&r&&"number"==typeof r){if(r<0)throw new TypeError("请输入有效的有效期");n.time=a?Date.now():this.getCreatedTime(e)||Date.now(),n.expires=r}t(this,l).setItem(e,JSON.stringify(n)),t(this,u).add(e)}},{key:"get",value:function(e,t){var i=this.getFullData(e);return i&&void 0!==i.value?i.time?Date.now()-i.time<i.expires?i.value:(this.remove(e),t):i.value:t}},{key:"getCreatedTime",value:function(e){var t=this.getFullData(e);if(t&&t.time)return t.time}},{key:"getFullData",value:function(e){if(e=this.getFullKey(e),t(this,u).has(e)){var i=t(this,l).getItem(e)||"{}";try{var r=JSON.parse(i);return"boolean"==typeof r||"number"==typeof r?{value:r}:r}catch(e){return{value:i}}}}},{key:"has",value:function(e){return e=this.getFullKey(e),!!t(this,u).has(e)&&void 0!==this.get(e)}},{key:"remove",value:function(e){return e=this.getFullKey(e),!!t(this,u).has(e)&&(t(this,l).removeItem(e),t(this,u).delete(e))}},{key:"clear",value:function(){var e=this;t(this,u).forEach(function(t){return e.remove(t)})}},{key:"prefix",get:function(){return t(this,s)},set:function(e){i(this,s,e),t(this,h).call(this)}}])&&e(a.prototype,n),o&&e(a,o),r}(),l=new WeakMap,u=new WeakMap,s=new WeakMap,h=new WeakMap;n=void 0,(a="version")in(r=o)?Object.defineProperty(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n,o.version="0.1.0";export default o;
